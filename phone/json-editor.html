<!DOCTYPE HTML>
<html>
<head>
    <!-- when using the mode "code", it's important to specify charset utf-8 -->
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">

    <link href="../node_modules/jsoneditor/dist/jsoneditor.min.css" rel="stylesheet" type="text/css">
    <style>
        div.jsoneditor-contextmenu ul {
            width: 200px;
        }
        div.jsoneditor-contextmenu ul li button {
            width: 200px;
        }
    </style>
    <script src="../node_modules/jsoneditor/dist/jsoneditor.min.js"></script>
</head>
<body>
    <div id="jsoneditor" style="width: 100%; height: 800px;"></div>

    <script>
        // create the editor
        var container = document.getElementById("jsoneditor");
        var options = {
            templates: [
                {
                    text: 'Fixed Options',
                    title: 'Insert a Option Node',
                    className: 'jsoneditor-type-object',
                    field: 'ussdcode',
                    value: {
                        "output" : " 1. Option 1, 2. Option 2,... 0. Previous Page., 00. Main Page ",
                        "return" : "option",
                        "destination" : "#",
                        "endpoint" : 0
                    }
                },
                {
                    text: 'User Defined Options',
                    title: 'Insert a Option Node',
                    field: 'UserDefinedOptions',
                    value: {
                        "output" : "Enter Amount",
                        "name": "amount",
                        "return" : "text",
                        "destination" : "*123*1*Step1",
                        "endpoint" : 0
                    }
                },
                {
                    text: 'confirmation',
                    title: 'Insert a Option Node',
                    field: 'confirmationFields',
                    value: {
                        "output": "{{amount}} NGN will be deducted from your account for this transaction passcode {{passcode}}., 1. confirm., 0. cancel., 00. main menu",
                        "name": "confirm",
                        "return" : "text",
                        "confirm": 1,
                        "destination" : "valuchargePayForSelf",
                        "endpoint" : 0
                    }
                }
            ],

            onEditable: function(node){
                if( node.field == "return" || node.field == "endpoint" || (node.field == "destination" && node.value == "#" )  ){
                    return {field: false, value: false};
                }
                else if (  node.field == "ussdcode" ||  node.field == "UserDefinedOptions" ||  node.field == "confirmationFields" ){
                    return {field: true, value: false};
                }
                else {
                    return {field: false, value: true};
                }
            },

            sortObjectKeys: false
        }
        var editor = new JSONEditor(container, options);

        // set json
        var json = {
            "ussdcode": {
                "output" : " 1. first option, 2. second option, ...",
                "return" : "option",
                "destination" : "#",
                "endpoint" : 0
            }
        };
        editor.set(json);

        // get json
        var json = editor.get();
    
        document.addEventListener('click', () => {
            var lis = document.querySelectorAll('li');
            lis.forEach(d => {
                var text = '';
                if(d.querySelector('.jsoneditor-text')) text = d.querySelector('.jsoneditor-text').innerText;
                if(text == "Append" || text == "Fixed Options" || text == "User Defined Options" || text == "confirmation" || text == "Remove" ) d.style.display = "block";
                else d.style.display = "none";
            });
        });

    </script>
</body>
</html>
